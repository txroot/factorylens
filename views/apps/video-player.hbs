{% extends "layouts/dash.hbs" %}

{% block content %}
<h2>{{ gettext("video_player_title") }}</h2>
<p>{{ gettext("video_player_description") }}</p>

<div class="row">
  {% for cam in cameras %}
  <div class="col-md-4 mb-4">
    <div class="card">
      <div class="card-body text-center">
        <h5 class="card-title">{{ cam.name }}</h5>

        <!-- Play in modal -->
        <button type="button" class="btn btn-primary play-btn me-2" data-cam-id="{{ cam.id }}"
          data-stream-url="{{ cam.stream_url }}" data-bs-toggle="modal" data-bs-target="#videoModal">
          <i class="ti ti-player-play"></i>
        </button>

        <!-- raw URL (opens VLC etc.) -->
        <a href="{{ cam.stream_url }}" target="_blank" class="btn btn-outline-secondary">
          <i class="ti ti-external-link"></i>
        </a>

        <!-- small spinner shown while JS waits -->
        <div class="spinner-border spinner-border-sm text-primary ms-2 d-none" role="status"></div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Modal -->
<div class="modal fade" id="videoModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ gettext("video_player_title") }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-0">
        <video id="modal-video" class="w-100" controls muted playsinline style="background:#000;"></video>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Bootstrap Bundle (includes Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<!-- hls.js for HLS playback -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<!-- Custom video player logic -->
<script src="{{ url_for('static', filename='js/apps/video-player.js') }}"></script>
{% endblock %}