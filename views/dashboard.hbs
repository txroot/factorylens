{% extends "layouts/dash.hbs" %}

{% block content %}
<h2 class="mt-4 fw-bold">{{ _('Factory Lens – Overview') }}</h2>
<p class="text-muted mb-4">{{ _('Real‑time status of devices and events (demo data).') }}</p>

<!-- Top metrics -->
<div class="row g-3 mb-4">
  <!-- Total devices -->
  <div class="col-md-3">
    <div class="card shadow-sm h-100">
      <div class="card-body d-flex flex-column justify-content-between">
        <div class="d-flex align-items-center">
          <i class="ti ti-devices display-6 text-primary me-3"></i>
          <div>
            <h5 class="mb-0">62</h5>
            <small class="text-muted">{{ _('Total Devices') }}</small>
          </div>
        </div>
        <div class="mt-3 small text-success">
          <i class="ti ti-arrow-up-right"></i> {{ _('4 added this week') }}
        </div>
      </div>
    </div>
  </div>

  <!-- Cameras -->
  <div class="col-md-3">
    <div class="card shadow-sm h-100">
      <div class="card-body d-flex flex-column justify-content-between">
        <div class="d-flex align-items-center">
          <i class="ti ti-camera display-6 text-info me-3"></i>
          <div>
            <h5 class="mb-0">12</h5>
            <small class="text-muted">{{ _('Cameras') }}</small>
          </div>
        </div>
        <div class="mt-3 small text-success">
          <i class="ti ti-check"></i> {{ _('All online') }}
        </div>
      </div>
    </div>
  </div>

  <!-- IoT modules -->
  <div class="col-md-3">
    <div class="card shadow-sm h-100">
      <div class="card-body d-flex flex-column justify-content-between">
        <div class="d-flex align-items-center">
          <i class="ti ti-cpu display-6 text-warning me-3"></i>
          <div>
            <h5 class="mb-0">30</h5>
            <small class="text-muted">{{ _('IoT Modules') }}</small>
          </div>
        </div>
        <div class="mt-3 small text-danger">
          <i class="ti ti-alert-triangle"></i> {{ _('2 offline') }}
        </div>
      </div>
    </div>
  </div>

  <!-- Alerts today -->
  <div class="col-md-3">
    <div class="card shadow-sm h-100">
      <div class="card-body d-flex flex-column justify-content-between">
        <div class="d-flex align-items-center">
          <i class="ti ti-bell-ringing display-6 text-danger me-3"></i>
          <div>
            <h5 class="mb-0">5</h5>
            <small class="text-muted">{{ _('Alerts Today') }}</small>
          </div>
        </div>
        <div class="mt-3 small text-muted">
          {{ _('Last alert') }} 12&nbsp;{{ _('min ago') }}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Events chart + recent alerts table -->
<div class="row g-4">
  <!-- Chart -->
  <div class="col-lg-8">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0">{{ _('Events (last 24 h)') }}</h6>
      </div>
      <div class="card-body">
        <canvas id="eventsChart" height="150"></canvas>
      </div>
    </div>
  </div>

  <!-- Alerts table -->
  <div class="col-lg-4">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-transparent border-0">
        <h6 class="mb-0">{{ _('Latest Alerts') }}</h6>
      </div>
      <div class="card-body p-0">
        <table class="table table-hover mb-0 small">
          <thead class="table-light">
            <tr>
              <th>{{ _('Time') }}</th>
              <th>{{ _('Device') }}</th>
              <th class="text-end">{{ _('Severity') }}</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>10:18</td>
              <td>relay02</td>
              <td class="text-end"><span class="badge bg-danger">{{ _('High') }}</span></td>
            </tr>
            <tr>
              <td>09:57</td>
              <td>camera07</td>
              <td class="text-end"><span class="badge bg-warning text-dark">{{ _('Medium') }}</span></td>
            </tr>
            <tr>
              <td>08:41</td>
              <td>sensor12</td>
              <td class="text-end"><span class="badge bg-danger">{{ _('High') }}</span></td>
            </tr>
            <tr>
              <td>07:05</td>
              <td>relay02</td>
              <td class="text-end"><span class="badge bg-info">{{ _('Info') }}</span></td>
            </tr>
            <tr>
              <td>07:00</td>
              <td>camera03</td>
              <td class="text-end"><span class="badge bg-warning text-dark">{{ _('Medium') }}</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
