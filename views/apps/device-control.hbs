{% extends "layouts/dash.hbs" %}

{% block head %}
  {{ super() }}
  <!-- Tabler Icons via CDN -->
  <link rel="stylesheet"
        href="https://unpkg.com/@tabler/icons@latest/iconfont/tabler-icons.min.css">
{% endblock %}

{% block content %}
<section class="container-fluid">
  <h2 class="mt-4 mb-3">{{ gettext("device_control_title") }}</h2>

  <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-4">
    {% for dev in devices %}
    <div class="col">
      <div class="card h-100 shadow-sm" data-dev-id="{{ dev.id }}">
        <!-- Header -->
        <div class="card-header d-flex justify-content-between align-items-center">
          <div class="d-flex align-items-center">
            <i class="ti ti-device-laptop fs-5 me-2"></i>
            <h6 class="mb-0">{{ dev.name }}</h6>
          </div>
          <span>
            <i class="ti ti-circle-fill text-{{ 'success' if dev.status=='online' else 'secondary' }}"></i>
            <small class="ms-1 text-{{ 'success' if dev.status=='online' else 'secondary' }}">
              {{ dev.status }}
            </small>
          </span>
        </div>

        <!-- Body -->
        <div class="card-body d-flex flex-column">

          <!-- I/O panel -->
          <div class="d-flex mb-3 align-items-start">
            <!-- Inputs column -->
            <div class="flex-fill text-center">
              <h6 class="small mb-2">
                <!-- moved the bulb icon into the title -->
                <i class="ti ti-circuit-switch-open fs-5 me-1 text-primary"></i> Inputs
              </h6>
              <div class="d-flex justify-content-around">
                {% for idx in [0,1] %}
                <div class="form-check">
                  <!-- use radio button, disabled (read-only) -->
                  <input class="form-check-input input-radio"
                        type="radio"
                        name="input-{{dev.id}}"
                        id="input-{{dev.id}}-{{idx}}"
                        disabled>
                  <label class="form-check-label" for="input-{{dev.id}}-{{idx}}">
                    I{{ idx }}
                  </label>
                </div>
                {% endfor %}
              </div>
            </div>

            <!-- vertical separator -->
            <div class="vr mx-3"></div>

            <!-- Outputs column -->
            <div class="flex-fill text-center">
              <h6 class="small mb-2">
                <!-- moved the power icon into the title -->
                <i class="ti ti-power fs-5 me-1 text-primary"></i> Outputs
              </h6>
              <div class="d-flex justify-content-around">
                {% for ch in [0,1] %}
                <div class="form-check form-switch">
                  <input class="form-check-input relay-toggle"
                        type="checkbox"
                        id="relay-{{dev.id}}-{{ch}}"
                        data-channel="{{ch}}">
                  <label class="form-check-label" for="relay-{{dev.id}}-{{ch}}">
                    R{{ ch }}
                  </label>
                </div>
                {% endfor %}
              </div>
            </div>
          </div>

          <!-- Sensors: temp + wattage + voltage -->
          <div class="mt-auto d-flex justify-content-around small text-muted bg-light">
            <div>
              <i class="ti ti-temperature fs-6 me-1"></i>
              <span id="temp-{{ dev.id }}">—°C</span>
            </div>
            <div>
              <i class="ti ti-plug fs-6 me-1"></i>
              <span id="power-{{ dev.id }}">— W</span>
            </div>
            <div>
              <i class="ti ti-battery fs-6 me-1"></i>
              <span id="voltage-{{ dev.id }}">— V</span>
            </div>
          </div>

        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/apps/device-control.js') }}"></script>
{% endblock %}
